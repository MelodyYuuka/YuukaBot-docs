# 东方幻存神签

## 概述

根据 《东方幻存神签》 的设定资料进行抽签

## 指令

### 六面骰子

- 指令： `/抽幻存神签`
- 别名： `/抽神签`、`东方幻存神签`、`/抽六面幻存神签`

- 详情：

  用六面骰子抽取幻存神签

### 八面骰子

- 指令： `/抽八面幻存神签`

- 详情：

  用八面骰子抽取幻存神签

### 原理

:::: details 原文引用

::: tabs

@tab ◉骰子（六面）占卜法

＊使用六面骰时，仅投掷三次无法确保以均等概率得出结果。

①投掷三次骰子，并记录结果。

　如果，第一次投掷时，

　掷出5或6的话

　需重掷至结果为1～4为止。

　例：〔第一次〕6因此重掷得2，

　　　〔第二次〕5，〔第三次〕1

②代入以下公式计算。

　（第一次结果×36）+（第二次结果×6）+ 第三次结果-42

　例：（2 × 36）+（5 × 6）+ 1 - 42 = 61

③所得数字对应的神签即代表您的运势。

　注意，约有11%概率出现129及以上数值。

　此时请重新占卜。

@tab ◉骰子（八面）占卜法

①投掷三次骰子，并记录结果。

　例：〔第一次〕7，〔第二次〕3，〔第三次〕6

②代入以下公式计算。

　（第一次结果为奇数则为0，偶数则为64）+

　（第二次结果×8）+ 第三次结果-8

　例：（7是奇数所以为0）

　　　　 +

　　（3 × 8）

　　　　 +

　　6 - 8 = 22

③所得数字对应的神签即代表您的运势。

:::

::::

:::: details 证明均匀分布

- **第一次投掷结果（$A$）**：仅取值$1$、$2$、$3$、$4$，每个值概率均为$\frac{1}{4}$（因为$5$或$6$时重掷，直到出现$1$~$4$）。
- **第二次投掷结果（$B$）**：取值$1$、$2$、$3$、$4$、$5$、$6$，每个值概率$\frac{1}{6}$。
- **第三次投掷结果（$C$）**：取值$1$、$2$、$3$、$4$、$5$、$6$，每个值概率$\frac{1}{6}$。
- **$A$, $B$, $C$ 相互独立**，因此所有可能的组合$(A, B, C)$总数为$4 \times 6 \times 6 = 144$，每个组合概率为$\frac{1}{144}$。
- **计算公式**：$S = 36A + 6B + C - 42$。
- **有效范围**：当$S \geq 129$时需重掷，因此仅考虑$S \leq 128$的结果。

1. **计算$S$的可能值范围**：
   - $A$固定时，$6B + C$的取值范围为$7$到$42$（因为$B$和$C$各独立取值$1$~$6$）。
   - 因此：
     - 若$A = 1$，$S = 36 \times 1 + (6B + C) - 42$范围：$(36 + 7) - 42 = 1$到$(36 + 42) - 42 = 36$。
     - 若$A = 2$，$S$范围：$37$到$72$。
     - 若$A = 3$，$S$范围：$73$到$108$。
     - 若$A = 4$，$S$范围：$109$到$144$。
   - $S$的全局范围为$1$到$144$。

2. **有效$S$值（$1$~$128$）的映射**：
   - 对于$S$值$1$到$108$（来自$A = 1, 2, 3$）：每个$S$值恰好对应一个$(A, B, C)$组合（因为$A$固定时，$6B + C$覆盖$7$~$42$的整数，每个值唯一）。
   - 对于$S$值$109$到$128$（来自$A = 4$，且$S \leq 128$）：每个$S$值也恰好对应一个$(A, B, C)$组合。
   - 因此，每个$S$值在$1$到$128$范围内，**恰好有一个$(A, B, C)$组合与之对应**。
   - 有效组合总数：$128$（因为$S = 129$到$144$的$16$个值无效，需重掷）。

3. **概率分析**：
   - 所有$144$个组合概率均等（各$\frac{1}{144}$）。
   - 有效结果（$S \leq 128$）的总概率为$\frac{128}{144} = \frac{8}{9}$。
   - 对于任意$s \in \{1, 2, \dots, 128\}$，条件概率为：
     $$
     P(S = s \mid S \leq 128) = \frac{P(S = s)}{P(S \leq 128)} = \frac{\frac{1}{144}}{\frac{128}{144}} = \frac{1}{128}.
     $$
   - 因此，在$S \leq 128$条件下，每个$s$出现概率均为$\frac{1}{128}$，即均匀分布。
   - 出现无效结果时（$S \geq 129$）重新投掷，所以在总体上保持均匀分布。

::::
